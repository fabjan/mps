<html>
<head>
<meta name="viewport" content="width=device-width, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<link rel="stylesheet" href="pure.css">
<style>
#gamepad table button {
  width: 100%;
  height: 120%;
}
</style>
<script>
var DPAD = ["dpleft", "dpright", "dpup", "dpdown"];
var BUTTONS = ["a", "b", "x", "y"];
var INPUTS = DPAD.concat(BUTTONS);

var inputState = 0;

function stopIt(e) {
  e.preventDefault()
}

function valueFor(buttonName) {
  return Math.pow(2, INPUTS.indexOf(buttonName));
}

function press(buttonName) {
  inputState = inputState | valueFor(buttonName);
}

function release(buttonName) {
  inputState = inputState ^ valueFor(buttonName);
}

function send() {
  console.log("sending input", inputState);
  document.getElementById("messages").innerText = inputState;
}

window.onload = function() {
  window.ontouchmove = window.ontouchstart = stopIt;

  INPUTS.forEach(function(elementId) {
    var element = document.getElementById(elementId);
    if (!element) return;
    element.onmousedown = element.ontouchstart = function() {
      press(elementId);
      send();
    };
    element.onmouseup = element.ontouchend = function() {
      release(elementId);
      send();
    };
  });
}
</script>
</head>
<body>
<form class="pure-form">
  <fieldset>
     <input type="host" placeholder="Hostname">
     <input type="port" placeholder="Port">
     <button type="submit" class="pure-button pure-button-primary">Connect</button>
     <label id="messages">-</label>
  </fieldset>
</form>
<div id="gamepad">
  <table id="dpad" width="49%" height="50%" style="display: inline">
    <tr><td/><td><button class="pure-button" id="dpup">^</button></td></tr>
    <tr><td><button class="pure-button" id="dpleft">&lt;-</button></td>
        <td/>
        <td><button class="pure-button" id="dpright">-&gt;</button></td></tr>
    <tr><td/><td><button class="pure-button" id="dpdown">v</button></td></tr>
  </table>
  <table id="buttons" width="49%" height="50%" style="display: inline">
    <tr><td/><td><button class="pure-button" id="y">Y</button></td></tr>
    <tr><td><button class="full pure-button" id="x">X</button></td>
        <td/>
        <td><button class="pure-button" id="b">B</button></td></tr>
    <tr><td/><td><button class="pure-button" id="a">A</button></td></tr>
  </table>
</div>
